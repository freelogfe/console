(window.webpackJsonp=window.webpackJsonp||[]).push([["contract"],{"0Nxv":function(t,e,a){},"2Wqj":function(t,e){},AlM9:function(t,e,a){"use strict";var n=a("6tqe"),r={name:"table-view",data:function(){return{loading:!1,tableData:[],total:0}},props:{data:{type:Array,default:function(){return[]}},showPagination:{type:Boolean,default:!0},formatHandler:{type:Function,default:null},paginationOptions:{type:Object,default:function(){return{pageSizes:[10,20,30,50]}}},loader:Function,pageMeta:{type:Object,default:function(){var t=n.c.get("PAGE_".concat(this.$route.fullPath,"_index"))||{};return Object.assign({pageSize:10,page:1},t)}}},beforeDestroy:function(){this.pageMeta&&this.pageMeta.keyWords&&delete this.pageMeta.keyWords,n.c.set("PAGE_".concat(this.pageUrl,"_index"),this.pageMeta)},mounted:function(){this.pageUrl=this.$route.fullPath,this.tableData=this.data,this.total=this.tableData.length,this.load(),this.$on("reload",this.reload.bind(this))},methods:{reload:function(t){this.load(t)},load:function(t){var e=this;Object.assign(this.pageMeta,t||{}),this.loader&&(this.loading=!0,this.loader(this.pageMeta).then(function(t){var a=t.getData();if(e.loading=!1,a){var n=a.dataList||a;e.formatHandler&&(n=e.formatHandler(n)),e.tableData=n,a.dataList?(e.total=a.totalItem,e.pageMeta.page=a.page||1):e.total=n.length}else e.$message.error(a.msg)}).catch(function(t){e.$message.warning("加载失败"),e.loading=!1}))},handleSizeChange:function(t){var e={pageSize:t};this.load(e),this.$emit("sizeChange",e)},handleCurrentChange:function(t){var e={page:t};this.load(e),this.$emit("pageChange",e)}}},o=(a("KOIe"),a("KHd+")),s=Object(o.a)(r,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading.body",value:t.loading,expression:"loading",modifiers:{body:!0}}],staticClass:"table-view-wrapper"},[a("el-table",{staticClass:"table",attrs:{data:t.tableData,stripe:"",border:""}},[t._t("default")],2),t._v(" "),a("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.showPagination,expression:"showPagination"}],staticClass:"pagination",attrs:{background:!0,"current-page":t.pageMeta.page,"page-sizes":[10,20,30,50],"page-size":t.pageMeta.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)},[],!1,null,"361849fa",null);e.a=s.exports},HGP2:function(t,e,a){"use strict";a.r(e);var n=a("AlM9"),r=a("zQX5"),o=a("3eXy");a("snnE");function s(t){return o.ContractService.get(t).then(function(t){return t.getData()})}var c={loadDetail:s,onloadContractDetail:s},i=a("tpTV"),l=a("59r6"),u=a("1O/z"),d=a("IP6f"),p=a("Po4U"),h=a.n(p),f=a("PPAp"),g=a.n(f),v=a("2Wqj"),b=a.n(v),m=(r.a,h.a,g.a,b.a,{contract:c,node:i.a,resource:l.a,user:u.a,presentable:d.a}),C=a("ExDf");a("b1je");function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var y={name:"node-contracts",data:function(){return{contractList:[],query:"",presentables:[],currentContract:{}}},components:{TableView:n.a,ContractDetail:C.a},mounted:function(){var t=this,e=this.$route.query;this.loadPresentables({nodeId:this.$route.params.nodeId,isOnline:2}).then(function(a){var n=a.map(function(t){return t.presentableId});n.length&&t.loadContractInfos(n).then(function(a){a.forEach(function(a){var n=[],o=[],s={};a.contracts=a.contracts.filter(function(c){if(o.push(c.resourceId),n.push(c.contractId),s[c.contractId]=c,r.a.format(c),e.contractId===c.contractId&&t.showContractDetailHandler(c),!c.isMasterContract)return c;a.masterContract=c})}),console.log(a),t.presentables=a})})},methods:{loadContractsDetail:function(t){return this.$axios.get("v1/contracts/contractRecords",{params:{contractIds:t.join(",")}}).then(function(t){return t.getData()})},loadContractInfos:function(t){return this.$axios.get("v1/presentables/contractInfos",{params:{nodeId:this.$route.params.nodeId,presentableIds:t.join(",")}}).then(function(t){return t.getData()})},loadResourceData:function(t){return this.$axios.get("/v1/resources/list",{params:{resourceIds:t.join(",")}}).then(function(t){return t.getData()})},loadContracts:function(t){return this.$services.contract.get(t||{}).then(function(t){return t}).catch(this.$error.showErrorMessage)},loadPresentables:function(t){return m.presentable.loadDetail({params:t}).catch(this.$error.showErrorMessage)},mergeDataByResourceId:function(t,e){var a=this,n={};e.forEach(function(t){n[t.resourceId]=t}),t.forEach(function(t){var e=n[t.resourceId]||null;a.$set(t,"resourceDetail",e)})},loader:function(){var t=this,e=this;return function(a){var n=e.$route.params.nodeId;return"object"===I(a)&&(Object.assign(a,{partyTwo:n,contractType:2}),a={params:a}),e.loadContracts(a).then(function(a){if(!a.data.data)return[];var n=a.data.data.dataList;if(n.forEach(function(t){r.a.format(t)}),!n.length)return a;var o=n.map(function(t){return t.resourceId});return Promise.all([t.loadResourceData(o)]).then(function(t){var a=t[0];return e.mergeDataByResourceId(n,a),console.log(n),n})})}},handlePresentable:function(t){var e=this.$route.params.nodeId;t.presentableDetail?this.$router.push({path:"/node/".concat(e,"/presentable/detail"),query:{presentableId:t.presentableDetail.presentableId}}):this.$router.push({path:"/node/".concat(e,"/presentable/detail#presentable"),query:{contractId:t.contractId}})},previewHandler:function(t){var e={};t.presentableDetail?e.presentableId=t.presentableDetail.presentableId:e.contractId=t.contractId,this.$router.push({path:"/node/".concat(this.$route.params.nodeId,"/presentable/detail#contract"),query:e})},showContractDetailHandler:function(t){t&&t.contractId&&(this.currentContract=t)},resolveContractCreatorLink:function(t){return"/node/".concat(this.$route.params.nodeId,"/presentable/").concat(t.presentableId,"/scheme_detail")},updateContractHandler:function(t){Object.assign(this.currentContract,t)},isActiveTab:function(t){var e=this.currentContract.contractId;return console.log(e,t.masterContract?e===t.masterContract.contractId:e===t.contractId),e&&(t.masterContract?e===t.masterContract.contractId:e===t.contractId)}}},D=(a("oLsw"),a("KHd+")),_=Object(D.a)(y,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"node-contracts-container"},[a("div",{staticClass:"contract-list-wrapper"},[t._m(0),t._v(" "),a("ul",{staticClass:"presentable-list"},t._l(t.presentables,function(e){return a("li",{staticClass:"presentable-item"},[a("div",{staticClass:"presentable-name",class:[e.masterContract?"contract-status-"+e.masterContract.status:"",{current:t.isActiveTab(e)}],on:{click:function(a){t.showContractDetailHandler(e.masterContract)}}},[a("i",{staticClass:"dot"}),t._v(t._s(e.presentableName)+"\n          "),e.masterContract?a("span"):a("span",[a("router-link",{attrs:{to:t.resolveContractCreatorLink(e)}},[t._v("未创建合同")])],1)]),t._v(" "),e.contracts.length?a("ul",{staticClass:"contract-list"},t._l(e.contracts,function(e){return a("li",{staticClass:"contract-item",class:["contract-status-"+e.status,{current:t.currentContract.contractId===e.contractId}],on:{click:function(a){t.showContractDetailHandler(e)}}},[a("div",[a("i",{staticClass:"dot"}),t._v("子资源合同ID： "+t._s(e.contractId))]),t._v(" "),e.resourceDetail?a("div",[a("div",[t._v(t._s(e.resourceDetail.resourceName))])]):t._e()])})):t._e()])}))]),t._v(" "),t.currentContract.contractId?a("div",{staticClass:"contract-exec-container"},[a("contract-detail",{attrs:{contractId:t.currentContract.contractId},on:{update:t.updateContractHandler}})],1):t._e()])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{staticClass:"contract-list-title"},[e("i",{staticClass:"el-icon-question"}),this._v("合约列表")])}],!1,null,"2c58893d",null);e.default=_.exports},IP6f:function(t,e,a){"use strict";var n=a("3eXy");a("snnE");function r(t){return n.PresentablesService.get(t).then(function(t){return t.getData()})}var o=r;e.a={loadDetail:r,onloadPresentableDetail:o}},KOIe:function(t,e,a){"use strict";var n=a("0Nxv");a.n(n).a},PPAp:function(t,e){},Po4U:function(t,e){},oLsw:function(t,e,a){"use strict";var n=a("qztq");a.n(n).a},qztq:function(t,e,a){}}]);