(window.webpackJsonp=window.webpackJsonp||[]).push([["policy-tpl"],{"0Nxv":function(t,e,a){},"1FqC":function(t,e,a){"use strict";var i=a("8KGa");a.n(i).a},"2hn1":function(t,e,a){"use strict";e.a={name:[{min:2,max:40,message:"长度在 2 到 40 个字符",trigger:"blur"},{required:!0,message:"模板描述必填",trigger:"blur"}],template:[{required:!0,message:"策略模板内容必填",trigger:"blur"}]}},"6LgU":function(t,e,a){"use strict";a.r(e);var i=a("NKFe"),n=a.n(i),l=a("hnv+"),r=a.n(l),s={name:"policy-template-detail-info",props:{data:{type:Object,default:function(){return{}}}},mounted:function(){},methods:{resolveType:function(t){return 1===t?"资源策略模板":"用户策略模板"},resolveStatus:function(t){return 0===t?"正常":"已删除"}}},o=a("KHd+"),c=Object(o.a)(s,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{staticClass:"small-el-form",attrs:{"label-position":"right","label-width":"100px"}},[a("el-form-item",{attrs:{label:"ID"}},[t._v("\n    "+t._s(t.data.id)+"\n  ")]),t._v(" "),a("el-form-item",{attrs:{label:"策略模板描述"}},[t._v("\n    "+t._s(t.data.name)+"\n  ")]),t._v(" "),a("el-form-item",{attrs:{label:"策略模板类型"}},[t._v("\n    "+t._s(t.resolveType(t.data.templateType))+"\n  ")]),t._v(" "),a("el-form-item",{attrs:{label:"状态"}},[t._v("\n    "+t._s(t.resolveStatus(t.data.status))+"\n  ")]),t._v(" "),a("el-form-item",{attrs:{label:"创建时间"}},[t._v("\n    "+t._s(t._f("fmtDate")(t.data.createDate))+"\n  ")]),t._v(" "),t._t("default")],2)},[],!1,null,null,null).exports,u=a("2hn1"),d=a("yfc9"),p="view",m="edit",f={name:"policy-tpl-detail",data:function(){return{mode:p,detail:{},rules:u.a}},components:{PolicyTemplateDetailInfo:c},computed:{isEditMode:function(){return this.mode===m}},mounted:function(){var t=this,e=this.$route.query;e.id?this.loadDetail(e.id).then(function(e){t.detail=e}):this.$message.error("参数有误")},methods:{loadDetail:function(t){return this.$services.policyTemplate.get(t).then(function(t){return t.getData()})},changeModeHandler:function(){var t=this;this.mode===m?this.$refs.detailForm.validate(function(e){console.log("valid",e),e&&t.validatePolicy().then(function(e){e?t.$message.error(e):(t.saveDetail(),t.mode=p)})}):this.mode=m},validatePolicy:function(){var t=Promise.resolve(),e=this.detail.template,a="node"===this.type,i=a?r.a.compile(e):n.a.compile(e);return i.errorMsg||(this.detail.template=a?r.a.beautify(e):n.a.beautify(e)),t.then(function(){return i.errorMsg})},cancelEditMode:function(){this.mode=p},saveDetail:function(){this.$services.policyTemplate.put(this.detail.id,{name:this.detail.name,template:btoa(this.detail.template)})},resolveType:function(t){return d.b(t)},resolveStatus:function(t){return d.a(t)}}},h=(a("u/p/"),Object(o.a)(f,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("el-form",{ref:"detailForm",staticClass:"small-el-form",attrs:{"label-position":"right",model:t.detail,rules:t.rules,"inline-message":!0,"label-width":"120px"}},[a("el-form-item",{staticClass:"flex-grid",attrs:{label:"ID"}},[t._v("\n      "+t._s(t.detail.id)+"\n    ")]),t._v(" "),a("el-form-item",{staticClass:"flex-grid",staticStyle:{height:"40px"},attrs:{label:"策略模板描述",prop:"name",required:t.isEditMode}},[t.isEditMode?a("el-input",{staticStyle:{width:"600px"},model:{value:t.detail.name,callback:function(e){t.$set(t.detail,"name",e)},expression:"detail.name"}}):a("span",[t._v(t._s(t.detail.name))])],1),t._v(" "),a("el-form-item",{staticClass:"flex-grid",attrs:{label:"策略模板类型"}},[t._v("\n      "+t._s(t.resolveType(t.detail.templateType))+"\n    ")]),t._v(" "),a("el-form-item",{staticClass:"flex-grid",attrs:{label:"状态"}},[t._v("\n      "+t._s(t.resolveStatus(t.detail.status))+"\n    ")]),t._v(" "),a("el-form-item",{staticClass:"flex-grid",attrs:{label:"创建时间"}},[t._v("\n      "+t._s(t._f("fmtDate")(t.detail.createDate))+"\n    ")]),t._v(" "),a("el-form-item",{attrs:{label:"策略",required:t.isEditMode,prop:"template"}},[t.isEditMode?a("el-input",{staticStyle:{width:"600px"},attrs:{type:"textarea",rows:10},model:{value:t.detail.template,callback:function(e){t.$set(t.detail,"template",e)},expression:"detail.template"}}):a("pre",[t._v(t._s(t.detail.template))])],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.changeModeHandler}},[t._v(t._s(t.isEditMode?"保存":"修改"))]),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.isEditMode,expression:"isEditMode"}],attrs:{type:"primary",plain:""},on:{click:t.cancelEditMode}},[t._v("取消")])],1)],1)],1)},[],!1,null,"2549e78e",null));e.default=h.exports},"8KGa":function(t,e,a){},AlM9:function(t,e,a){"use strict";var i=a("6tqe"),n={name:"table-view",data:function(){return{loading:!1,tableData:[],total:0}},props:{data:{type:Array,default:function(){return[]}},showPagination:{type:Boolean,default:!0},formatHandler:{type:Function,default:null},paginationOptions:{type:Object,default:function(){return{pageSizes:[10,20,30,50]}}},loader:Function,pageMeta:{type:Object,default:function(){var t=i.c.get("PAGE_".concat(this.$route.fullPath,"_index"))||{};return Object.assign({pageSize:10,page:1},t)}}},beforeDestroy:function(){this.pageMeta&&this.pageMeta.keyWords&&delete this.pageMeta.keyWords,i.c.set("PAGE_".concat(this.pageUrl,"_index"),this.pageMeta)},mounted:function(){this.pageUrl=this.$route.fullPath,this.tableData=this.data,this.total=this.tableData.length,this.load(),this.$on("reload",this.reload.bind(this))},methods:{reload:function(t){this.load(t)},load:function(t){var e=this;Object.assign(this.pageMeta,t||{}),this.loader&&(this.loading=!0,this.loader(this.pageMeta).then(function(t){var a=t.getData();if(e.loading=!1,a){var i=a.dataList||a;e.formatHandler&&(i=e.formatHandler(i)),e.tableData=i,a.dataList?(e.total=a.totalItem,e.pageMeta.page=a.page||1):e.total=i.length}else e.$message.error(a.msg)}).catch(function(t){e.$message.warning("加载失败"),e.loading=!1}))},handleSizeChange:function(t){var e={pageSize:t};this.load(e),this.$emit("sizeChange",e)},handleCurrentChange:function(t){var e={page:t};this.load(e),this.$emit("pageChange",e)}}},l=(a("KOIe"),a("KHd+")),r=Object(l.a)(n,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading.body",value:t.loading,expression:"loading",modifiers:{body:!0}}],staticClass:"table-view-wrapper"},[a("el-table",{staticClass:"table",attrs:{data:t.tableData,stripe:"",border:""}},[t._t("default")],2),t._v(" "),a("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.showPagination,expression:"showPagination"}],staticClass:"pagination",attrs:{background:!0,"current-page":t.pageMeta.page,"page-sizes":[10,20,30,50],"page-size":t.pageMeta.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)},[],!1,null,"361849fa",null);e.a=r.exports},KOIe:function(t,e,a){"use strict";var i=a("0Nxv");a.n(i).a},WvoA:function(t,e,a){"use strict";a.r(e);var i=a("DonJ"),n=a.n(i),l=a("7JPV"),r=a("2hn1"),s={name:"policy-tpl-creator",data:function(){var t=this.$route.meta.type;return{type:t,data:{name:"",template:"",templateType:"node"===t?2:1},rules:r.a}},mounted:function(){},methods:{createPolicyTpl:function(t){var e=this;return this.$services.policyTemplate.post(t).then(function(t){var a=t.data;0===a.errcode?(e.$message.success("创建成功"),e.$router.push({path:"/".concat(e.type,"/policy_tpl/detail"),query:{id:a.data.id}})):e.$error.showErrorMessage(t)}).catch(this.$error.showErrorMessage)},validatePolicy:function(){var t=this.data.template,e=(this.type,n.a.compile(t));return e.errorMsg?(this.$message.error(e.errorMsg),!1):(this.data.template=Object(l.highlightPolicy)(t),this.$message.success("校验通过"),!0)},submitHandler:function(){var t=Object.assign({},this.data);this.validatePolicy()&&(t.template=btoa(t.template),this.createPolicyTpl(t))}}},o=(a("1FqC"),a("KHd+")),c=Object(o.a)(s,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("el-form",{ref:"createForm",staticClass:"input-form",attrs:{model:t.data,"label-width":"120px",rules:t.rules}},[a("el-form-item",{attrs:{label:"策略模板描述",prop:"name",required:""}},[a("el-input",{model:{value:t.data.name,callback:function(e){t.$set(t.data,"name",e)},expression:"data.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"策略模板描述",prop:"template",required:""}},[a("el-input",{attrs:{type:"textarea",rows:15,placeholder:"请输入策略"},model:{value:t.data.template,callback:function(e){t.$set(t.data,"template",e)},expression:"data.template"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",plain:""},on:{click:t.validatePolicy}},[t._v("校验策略")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.submitHandler}},[t._v("创建")])],1)],1)],1)},[],!1,null,"c4cdb620",null);e.default=c.exports},dAFC:function(t,e,a){},j0C6:function(t,e,a){},"u/p/":function(t,e,a){"use strict";var i=a("dAFC");a.n(i).a},vO2R:function(t,e,a){"use strict";var i=a("j0C6");a.n(i).a},yfc9:function(t,e,a){"use strict";var i;function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}a.d(e,"b",function(){return c}),a.d(e,"a",function(){return u});var l=1,r=2,s=(n(i={},l,{value:l,desc:"资源策略模板"}),n(i,r,{value:r,desc:"用户策略模板"}),i),o={0:{value:0,desc:"正常"},1:{value:1,desc:"已删除"}};function c(t){return s[t]?s[t].desc:"策略模板"}function u(t){return o[t]?o[t].desc:"未知"}},zCmL:function(t,e,a){"use strict";a.r(e);var i=a("AlM9"),n=a("yfc9");function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r={name:"policy-tpl-list",data:function(){return{type:this.$route.meta.type||"resource"}},components:{TableView:i.a},computed:{getCreateLink:function(){return"/".concat(this.type,"/policy_tpl/create")}},mounted:function(){},methods:{loader:function(){var t=this;return function(e){return"object"===l(e)&&(e.templateType="node"===t.type?2:1,e={params:e}),t.$services.policyTemplate.get(e||{})}},resolveType:function(t){return n.b(t)},resolveStatus:function(t){return n.a(t)},handleEdit:function(t){this.$router.push({path:"/".concat(this.type,"/policy_tpl/detail"),query:{id:t.id}})}}},s=(a("vO2R"),a("KHd+")),o=Object(s.a)(r,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("div",{staticClass:"top-sec"},[a("router-link",{staticClass:"route-link",attrs:{to:t.getCreateLink}},[a("el-button",{attrs:{type:"primary"}},[t._v("创建新策略模板")])],1)],1),t._v(" "),a("table-view",{staticClass:"policy-tpl-list",attrs:{loader:t.loader()}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"350px"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"模板名称"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t.resolveStatus(e.row.status))+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"",align:"center",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"small"},on:{click:function(a){t.handleEdit(e.row)}}},[t._v("详情\n        ")])]}}])})],1)],1)},[],!1,null,"5facf0e2",null);e.default=o.exports}}]);