(window.webpackJsonp=window.webpackJsonp||[]).push([["presentable"],{"+cXM":function(e,t,a){"use strict";a.r(t);var n=a("8SHQ"),s=a("vNxF"),r={name:"fl-switch",data:function(){return{checked:!1}},props:{width:{type:String,default:function(){return"50px"}},value:{type:[Boolean,String,Number],default:!1},activeText:String,inactiveText:String},watch:{},mounted:function(){this.checked=this.value},computed:{},methods:{switchHandler:function(){this.checked=!this.checked,this.$emit("input",this.checked),this.$emit("change",this.checked)}}},i=(a("0T9k"),a("KHd+")),c=Object(i.a)(r,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"fl-switch-wrap"},[a("div",{staticClass:"switch-container",class:[e.checked?"active-switch":"inactive-switch"],on:{click:e.switchHandler}},[a("i",{staticClass:"switch-mesh"}),e._v(" "),a("span",{staticClass:"switch-label"},[e._v(e._s(e.checked?e.activeText:e.inactiveText))])])])},[],!1,null,"7ac8082e",null).exports,o=a("H2zm"),l=n.a.PRESENTABLE_STATUS_TIPS,u={name:"presentables",data:function(){return{showSearchResource:!1,presentableList:[],currentPresentable:{index:-1,detail:{}}}},components:{PresentableDetail:s.default,FreelogSwitch:c,SearchResource:o.a},watch:{$route:function(){this.initView(this.$route.params.nodeId)}},mounted:function(){this.initView(this.$route.params.nodeId)},methods:{queryHandler:function(){this.$message.warning("待开发")},initView:function(e){var t=this;e?(Object.assign(this.currentPresentable,{index:-1,detail:{}}),this.loadPresentables({nodeId:e,isOnline:2}).then(this.formatHandler.bind(this)).then(function(e){t.presentableList=e})):this.$message.error("缺失节点ID参数")},formatHandler:function(e){var t=this;return e&&e.length?(e.forEach(function(e){t.resolvePresentable(e)}),e):[]},resolvePresentable:function(e){e.isOnlineChecked=!!e.isOnline,e._statusInfo=l[e.status],e.isReady=3==(3&e.status)},loadPresentables:function(e){return this.$services.presentables.get({params:e}).then(function(e){return e.getData()}).catch(this.$error.showErrorMessage)},changePresentableHandler:function(e,t){this.currentPresentable.index=t,this.currentPresentable.detail=e},changePresentableOnlineHandler:function(e){var t=this;e.isOnlineChecked?e.isOnline=1:e.isOnline=0,this.$services.presentables.put(e.presentableId,{isOnline:e.isOnline}).then(function(a){0===a.data.errcode||(e.isOnline=0,e.isOnlineChecked=!1,t.$message.error(a.data.msg||"更新失败"))}).catch(function(a){e.isOnline=0,e.isOnlineChecked=!1,t.$error.showErrorMessage(a)})},showSearchResourceHandler:function(){this.showSearchResource=!0},beforeCloseDialogHandler:function(){this.showSearchResource=!1},addResourceHandler:function(e){var t=this;this.createPresentable({nodeId:this.$route.params.nodeId,presentableName:e.resourceName,resourceId:e.resourceId}).then(function(e){t.presentableList.push(e),t.showSearchResource=!1}).catch(this.$error.showErrorMessage)},createPresentable:function(e){return this.$services.presentables.post(e).then(function(e){return 0!==e.data.errcode?Promise.reject(e.data.msg):e.getData()})},updatePresentableHandler:function(e){var t=this.currentPresentable.detail;Object.assign(t,e),this.resolvePresentable(t)}}},d=(a("PuKU"),Object(i.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"presentables-wrapper"},[a("div",{staticClass:"presentable-list-container"},[e._m(0),e._v(" "),a("ul",{staticClass:"presentable-list"},[e._l(e.presentableList,function(t,n){return a("li",{staticClass:"presentable-item",class:[t.isReady?"active-status-2":"active-status-0",{active:e.currentPresentable.index===n,"is-presentable-online":t.isOnlineChecked}],on:{click:function(a){e.changePresentableHandler(t,n)}}},[a("i",{staticClass:"dot"}),e._v(" "),a("freelog-switch",{staticClass:"node-res-status-switch",attrs:{"active-text":"上线","inactive-text":"下线"},on:{change:function(a){e.changePresentableOnlineHandler(t)}},model:{value:t.isOnlineChecked,callback:function(a){e.$set(t,"isOnlineChecked",a)},expression:"presentable.isOnlineChecked"}}),e._v(" "),a("span",{staticClass:"p-title"},[e._v(e._s(t.presentableName))])],1)}),e._v(" "),a("li",{staticClass:"presentable-item add-presentable-btn",on:{click:e.showSearchResourceHandler}},[a("i",{staticClass:"el-icon-plus"}),e._v("添加节点资源")])],2)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.currentPresentable.detail.presentableId,expression:"currentPresentable.detail.presentableId"}],staticClass:"presentable-detail-container"},[a("presentable-detail",{tag:"component",staticClass:"presentable-detail-content",attrs:{detail:e.currentPresentable.detail},on:{update:e.updatePresentableHandler}})],1),e._v(" "),a("el-dialog",{attrs:{visible:e.showSearchResource,width:"840px","close-on-click-modal":!1,"before-close":e.beforeCloseDialogHandler,top:"10vh",center:""},on:{"update:visible":function(t){e.showSearchResource=t}}},[a("p",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[e._v("添加资源")]),e._v(" "),a("search-resource",{staticClass:"add-resource-input",on:{add:e.addResourceHandler}})],1)],1)},[function(){var e=this.$createElement,t=this._self._c||e;return t("h4",[t("i",{staticClass:"el-icon-question"}),this._v("节点资源")])}],!1,null,"4713e4a5",null));t.default=d.exports},"0T9k":function(e,t,a){"use strict";var n=a("NN+/");a.n(n).a},"8SHQ":function(e,t,a){"use strict";var n={};a.r(n),a.d(n,"PRESENTABLE_STATUS_TIPS",function(){return i});var s=a("6ifa"),r=a("mL9P"),i=[{text:"测试状态",type:"info"},{text:"未开始执行",type:"danger"},{text:"执行中",type:"danger"},{text:"生效中",type:"success"},{text:"用户终止",type:"info"},{text:"系统终止",type:"info"}],c=a("DAk/");function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}t.a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){o(e,t,a[t])})}return e}({},s,r,n,c)},"8WhQ":function(e,t,a){},"DAk/":function(e,t,a){"use strict";a.r(t),a.d(t,"USER_GROUP_TYPE",function(){return n}),a.d(t,"NODE_GROUP_TYPE",function(){return s}),a.d(t,"GROUP_TYPES",function(){return r});var n=1,s=2,r=[{value:n,label:"用户分组"},{value:s,label:"节点分组"}]},ESlw:function(e,t,a){"use strict";var n={name:"freelog-tags",data:function(){return{tags:[],inputVisible:!1,inputValue:""}},props:{value:{type:Array,default:function(){return[]}},actionText:{type:String,default:function(){return"New Tag"}}},watch:{value:function(e){this.setCurrentValue(e)}},mounted:function(){this.setCurrentValue(this.value)},methods:{setCurrentValue:function(e){this.tags=e},handleClose:function(e){this.tags.splice(this.tags.indexOf(e),1),console.log(this.tags),this.$emit("input",this.tags)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var e=this.inputValue;e&&(this.tags.push(e),this.$emit("input",this.tags)),this.inputVisible=!1,this.inputValue=""}}},s=(a("kFP0"),a("KHd+")),r=Object(s.a)(n,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._l(e.tags,function(t){return a("el-tag",{key:t,staticClass:"user-defined-tag",attrs:{closable:"","disable-transitions":!1},on:{close:function(a){e.handleClose(t)}}},[e._v("\n    "+e._s(t)+"\n  ")])}),e._v(" "),e.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.handleInputConfirm(t):null}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInput}},[a("i",{staticClass:"el-icon-plus"}),e._v(" "+e._s(e.actionText))])],2)},[],!1,null,"03cf44fc",null);t.a=r.exports},Fq1f:function(e,t,a){"use strict";var n=a("o9SC");a.n(n).a},G2YG:function(e,t,a){"use strict";var n=a("g67i");a.n(n).a},IP6f:function(e,t,a){"use strict";var n=a("3eXy");a("snnE");function s(e){return n.PresentablesService.get(e).then(function(e){return e.getData()})}var r=s;t.a={loadDetail:s,onloadPresentableDetail:r}},LxJW:function(e,t,a){"use strict";var n=a("y8CG");a.n(n).a},"NN+/":function(e,t,a){},NPCl:function(e,t,a){"use strict";var n=a("ULDT");a.n(n).a},PuKU:function(e,t,a){"use strict";var n=a("RAcy");a.n(n).a},RAcy:function(e,t,a){},TUsp:function(e,t,a){},ULDT:function(e,t,a){},WUQS:function(e,t,a){},eDHJ:function(e,t,a){"use strict";a.r(t);var n=a("8SHQ"),s=a("NKFe"),r=a.n(s),i=a("ESlw"),c=a("b4GV"),o=a("rfs2"),l={name:"presentable-creator",data:function(){return{selectedIndex:!1}},props:{formData:Object},mounted:function(){},components:{FreelogTags:i.a,PresentableEditor:o.a,PresentablePolicy:c.a},methods:{segmentChangeHandler:function(e,t){void 0!==t&&(this.selectedIndex=t),e.selectedPolicy=e.data.policy[this.selectedIndex]||!1}}},u=(a("Fq1f"),a("KHd+")),d=Object(u.a)(l,function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.formData.data?a("div",{staticClass:"create-form-wrap"},[a("div",{staticClass:"step-1 op-step",attrs:{id:"js-form-step-1"}},[e._m(0),e._v(" "),a("el-table",{staticClass:"step-body contract-select-wrap",attrs:{data:e.formData.data.policy}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("pre",[e._v(e._s(t.row._formatSegmentText))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"segmentId",prop:"segmentId"}}),e._v(" "),a("el-table-column",{attrs:{label:"目标用户"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.forUsers,function(t,n){return a("el-tag",{key:n,attrs:{type:"individual"===t.type?"":"warning"}},[e._v("\n            "+e._s(t.users)+"\n          ")])})}}])}),e._v(" "),a("el-table-column",{attrs:{width:"100",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{attrs:{label:t.$index},on:{change:function(t){e.segmentChangeHandler(e.formData)}},model:{value:e.selectedIndex,callback:function(t){e.selectedIndex=t},expression:"selectedIndex"}},[a("span",{attrs:{title:"placeholder"}})]),e._v(" "),a("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:t.row.created,expression:"props.row.created"}],staticClass:"item",attrs:{effect:"dark",content:"该策略已经创建过合同",placement:"top"}},[a("i",{staticClass:"el-icon-info"})]),e._v(" "),a("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.selectedIndex===t.$index,expression:"selectedIndex===props.$index"}],staticClass:"item",attrs:{effect:"dark",content:"取消选择",placement:"top"}},[a("i",{staticClass:"el-icon-circle-close-outline",on:{click:function(t){e.segmentChangeHandler(e.formData,!1)}}})])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"step-2 op-step"},[e._m(1),e._v(" "),a("presentable-editor",{attrs:{data:e.formData.presentableInput}})],1),e._v(" "),e.formData.widgets&&e.formData.widgets.length>0?a("div",{staticClass:"step-3 op-step"},[e._m(2),e._v(" "),a("div",{staticClass:"step-body"},[a("el-alert",{attrs:{title:"该资源依赖以下资源，创建好page build后，需签约以下资源page build方可使用",type:"warning",closable:!1,"show-icon":""}}),e._v(" "),a("ul",{staticClass:"dep-widget-list"},e._l(e.formData.widgets,function(t){return a("li",{staticClass:"widget-detail-link"},[a("a",{attrs:{href:t.detailUrl,target:"_blank"}},[a("el-tag",{attrs:{type:"warning"}},[e._v(e._s(t.resourceId))])],1)])}))],1)]):e._e()]):e._e()},[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"step-header"},[t("div",{staticClass:"step-circle"},[this._v("1")]),this._v(" "),t("div",{staticClass:"step-title"},[this._v("选择合同策略"),t("span",{staticStyle:{color:"#f56c6c","margin-left":"3px"}},[this._v("*")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"step-header"},[t("div",{staticClass:"step-circle"},[this._v("2")]),this._v(" "),t("div",{staticClass:"step-title"},[this._v("创建用户消费策略")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"step-header"},[t("div",{staticClass:"step-circle"},[this._v("3")]),this._v(" "),t("div",{staticClass:"step-title"},[this._v("创建pagebuild presentable补充说明")])])}],!1,null,"52b28a5a",null).exports;function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,s=!1,r=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){s=!0,r=e}finally{try{n||null==c.return||c.return()}finally{if(s)throw r}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var p=n.a.RESOURCE_TYPES,f={name:"node-presentable-creator",data:function(){return{formData:{}}},mounted:function(){this.$route.query.resourceId?this.init():this.$message.error("没有资源Id, 请重新选择")},components:{PresentableCreator:d},computed:{canSubmit:function(){return!!this.formData.selectedPolicy}},methods:{init:function(){var e=this;this.loadPolicyDetail().then(this.queryContractsStatus.bind(this)).then(function(t){e.formData=t,console.log(e.formData.data.policy)}).catch(this.$error.showErrorMessage)},queryContractsStatus:function(e){var t=this.$route.params.nodeId;return this.$services.contractRecords.get({params:{contractType:2,resourceIds:e.resource.resourceId,partyTwo:t}}).then(function(t){return t.getData().forEach(function(t){if(e.resource.resourceId===t.resourceId){var a=e.data.policy,n=!0,s=!1,r=void 0;try{for(var i,c=a.entries()[Symbol.iterator]();!(n=(i=c.next()).done);n=!0){var o=h(i.value,2),l=(o[0],o[1]);if(l.segmentId===t.segmentId){l.created=!0;break}}}catch(e){s=!0,r=e}finally{try{n||null==c.return||c.return()}finally{if(s)throw r}}}}),e})},loadResourceDetail:function(e){return this.$services.resource.get(e).then(function(e){return e.getData()})},loadPolicyDetail:function(){var e=this,t=this.$route.query;return new Promise(function(a){a(e.loadResourceDetail(t.resourceId))}).then(function(t){var a={resource:t,data:{},presentableInput:{name:t.resourceName,policyText:"",userDefinedTags:[]},selectedPolicy:null};return a.widgets=t&&t.systemMeta&&t.systemMeta.widgets||[],a.widgets=a.widgets.map(function(e){return e.detailUrl="/resources/detail/".concat(e.resourceId),e}),e.$services.policy.get(t.resourceId).then(function(t){var n=t.getData();return n.policy.forEach(function(t){t.created=!1,t._formatSegmentText=e.formatSegmentText(t.segmentText),t.forUsers=t.users.map(function(e){return{type:e.userType,users:e.users.join(",")}})}),Object.assign(a.data,n),a})})},formatSegmentText:function(e){return r.a.beautify(e)},createResourceContract:function(e){return this.$services.contract.post(e).then(function(e){var t=e.getData();if(0!==e.data.errcode)throw new Error(e.data.msg);return t})},createPresentablePolicy:function(e){return this.$services.presentables.post(e).then(function(e){if(0===e.data.errcode)return e.getData();throw new Error(e.data.msg)})},extractSubmitData:function(){var e=parseInt(this.$route.params.nodeId),t=this.formData;return{contract:{contractType:"2",targetId:t.resource.resourceId,segmentId:t.selectedPolicy.segmentId,partyTwo:e},policy:{nodeId:e,name:t.presentableInput.name,resourceId:t.resource.resourceId,policyText:btoa(t.presentableInput.policyText),languageType:"freelog_policy_lang",userDefinedTags:t.presentableInput.userDefinedTags.join(",")}}},gotoPresentablDetail:function(e){var t=parseInt(this.$route.params.nodeId),a=this.$route.query.pbPresentableId,n=!!a;n||(n=(this.formData.resource.resourceType||e.tagInfo.resourceInfo.resourceType)===p.pageBuild);var s={ispb:n};e.presentableId?s.presentableId=e.presentableId:e.contractId&&(s.contractId=e.contractId);var r=a?{path:"/node/".concat(t,"/presentable/detail"),query:{presentableId:a,ispb:!0}}:{path:"/node/".concat(t,"/presentable/detail#presentable"),query:s};this.$router.push(r)},submit:function(){var e=this;if(!this.canSubmit)return document.body.scrollIntoView("#js-form-step-1"),this.$message.warning("未选择合同策略");var t=this.extractSubmitData();this.createResourceContract(t.contract).then(function(e){t.policy.contractId=e.contractId}).then(function(){if(t.policy.name&&t.policy.policyText)return e.createPresentablePolicy(t.policy)}).then(function(a){e.$message.success("presentable创建成功"),a?e.gotoPresentablDetail(a):e.gotoPresentablDetail(t.policy)}).catch(function(a){e.$error.showErrorMessage(a),e.gotoPresentablDetail(t.policy)})}}},m=(a("xdK5"),Object(u.a)(f,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[e.formData.resource?a("h3",{staticStyle:{"margin-bottom":"20px"}},[e._v("> "+e._s(e.formData.resource.resourceName))]):e._e(),e._v(" "),a("presentable-creator",{attrs:{formData:e.formData},on:{"update:formData":function(t){e.formData=t}}}),e._v(" "),a("div",{staticClass:"form-ft"},[a("el-button",{on:{click:e.submit}},[e._v("提交")])],1)],1)},[],!1,null,"70e1f8ac",null));t.default=m.exports},g67i:function(e,t,a){},iwFP:function(e,t,a){"use strict";var n=a("8WhQ");a.n(n).a},kFP0:function(e,t,a){"use strict";var n=a("TUsp");a.n(n).a},"n8+z":function(e,t,a){"use strict";var n=a("WUQS");a.n(n).a},o9SC:function(e,t,a){},rfs2:function(e,t,a){"use strict";var n=a("ESlw"),s=(a("mL9P"),a("b4GV")),r=(a("hnv+"),a("LvDl"),a("8SHQ").a.PRESENTABLE_STATUS_TIPS),i={name:"presentable-editor",data:function(){return{rules:{name:[{required:!0,message:"请输入presentable name",trigger:"blur"}]},inputData:{presentableName:"",policy:[],userDefinedTags:[]},userDefinedTags:[]}},components:{TagsEditor:n.a,PresentablePolicy:s.a},props:{data:{type:Object}},watch:{data:function(){this.initView()}},computed:{isValidPolicy:function(){return this.inputData.policy.some(function(e){return 1===e.status})}},mounted:function(){this.initView()},methods:{initView:function(){this.data.presentableId&&(Object.assign(this.inputData,this.data),this.userDefinedTags=this.inputData.userDefinedTags)},validatePolicyHandler:function(e){e.done&&this.$message.success("校验通过")},changePolicyHandler:function(){},formatPresentable:function(e){e._statusInfo=r[e.status],e.isReady=3==(3&e.status)},savePresentableHandler:function(){var e=this,t=this.$refs.editor.getChangeData(),a={presentableName:this.inputData.presentableName};a.userDefinedTags=this.userDefinedTags,Object.keys(t).length&&(a.policies=t),this.$services.presentables.put(this.data.presentableId,a).then(function(t){if(0===t.data.errcode){var a=t.getData();delete a.resourceInfo,Object.assign(e.inputData,a),e.formatPresentable(e.inputData),e.$emit("onSaveEnd",a),e.$message.success("更新成功")}else e.$message.error(t.data.msg||"更新失败")}).catch(this.$error.showErrorMessage)}}},c=(a("n8+z"),a("KHd+")),o=Object(c.a)(i,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"presentable-input-info"},[a("div",{staticClass:"presentable-input-item"},[e._m(0),e._v(" "),a("div",{staticClass:"p-input-item-content"},[a("el-input",{staticClass:"presentable-name-input",attrs:{placeholder:"输入节点资源名称"},model:{value:e.inputData.presentableName,callback:function(t){e.$set(e.inputData,"presentableName",t)},expression:"inputData.presentableName"}})],1)]),e._v(" "),a("div",{staticClass:"presentable-input-item"},[e._m(1),e._v(" "),a("div",{staticClass:"p-input-item-content"},[a("tags-editor",{attrs:{actionText:"新标签"},model:{value:e.userDefinedTags,callback:function(t){e.userDefinedTags=t},expression:"userDefinedTags"}})],1)]),e._v(" "),a("div",{staticClass:"presentable-input-item"},[a("p",{staticClass:"p-input-item-title",class:[e.isValidPolicy?"active-status-2":"active-status-0"]},[a("i",{staticClass:"dot"}),e._v("节点资源授权策略")]),e._v(" "),a("presentable-policy",{ref:"editor",attrs:{showValidate:!1},on:{change:e.changePolicyHandler},model:{value:e.inputData,callback:function(t){e.inputData=t},expression:"inputData"}})],1),e._v(" "),a("div",{staticClass:"presentable-input-ft"},[a("el-button",{staticClass:"p-input-btn",on:{click:e.savePresentableHandler}},[e._v("保存")])],1)])},[function(){var e=this.$createElement,t=this._self._c||e;return t("p",{staticClass:"p-input-item-title active-status-0"},[t("i",{staticClass:"dot",staticStyle:{visibility:"hidden"}}),this._v("节点资源名称")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",{staticClass:"p-input-item-title"},[t("i",{staticClass:"dot",staticStyle:{visibility:"hidden"}}),this._v("节点资源标签")])}],!1,null,"0bfc1d14",null);t.a=o.exports},tlFn:function(e,t,a){},vNxF:function(e,t,a){"use strict";a.r(t);a("hnv+");var n=a("b4GV"),s=a("ESlw"),r=(a("mL9P"),a("rfs2")),i=a("qTA6"),c=a("59r6"),o=a("aNms");function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var u={name:"presentable-detail",data:function(){return{showBindWidgetDialog:!1,loading:!1,bindWidget:{},presentableDetail:{},activeTabName:"resource",nodeId:this.$route.params.nodeId,editPresentable:{name:"",policyText:"",userDefinedTags:[]},presentableData:{resourceInfo:{}}}},props:{detail:{type:Object}},components:{PresentablePolicy:n.a,FreelogTags:s.a,PresentableEditor:r.a,ResourceIntroInfo:i.a},computed:{},watch:{"detail.presentableId":function(){this.initView()}},mounted:function(){this.initView()},methods:{initView:function(){var e=this;this.detail.resourceId&&(this.presentableData=this.detail,c.a.onloadResourceDetail(this.detail.resourceId).then(function(t){e.presentableData.resourceInfo=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){l(e,t,a[t])})}return e}({},t)}),this.loadPresentableScheme())},loadPresentableScheme:function(){var e=this,t=this.getPresentableContract();t&&o.a.onloadSchemeDetail(t.authSchemeId).then(function(a){if(a){for(var n=0;n<a.policy.length;n++){var s=a.policy[n];if(s.segmentId===t.policySegmentId){a.selectedPolicy=s;break}}e.$set(e.presentableData,"scheme",a)}})},getPresentableContract:function(){var e=this.presentableData.contracts||[];if(e.length)for(var t,a=0;a<e.length;a++)if((t=e[a]).resourceId===this.presentableData.resourceId)return t;return null},gotoSchemeDetailHandler:function(){this.$router.push({path:"/node/".concat(this.$route.params.nodeId,"/presentable/").concat(this.detail.presentableId,"/scheme_detail"),query:{resourceId:this.detail.resourceId}})},savePresentableEnd:function(e){this.$emit("update",e)}}},d=(a("G2YG"),a("NPCl"),a("KHd+")),h=Object(d.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"presentable-detail-wrapper"},[a("resource-intro-info",{staticClass:"res-intro-info",attrs:{resource:e.presentableData.resourceInfo}},[a("div",{staticClass:"presentable-auth-intro",class:{"active-status-2":e.presentableData.scheme},on:{click:e.gotoSchemeDetailHandler}},[a("i",{staticClass:"dot"}),e._v(" "),e.presentableData.scheme&&e.presentableData.scheme.selectedPolicy?a("span",[e._v("\n        "+e._s(e.presentableData.scheme.authSchemeName)+"/"+e._s(e.presentableData.scheme.selectedPolicy.policyName)+"\n      ")]):a("span",[e._v("未选择授权方案及授权策略")]),e._v(" "),a("i",{staticClass:"el-icon-edit"})])]),e._v(" "),a("presentable-editor",{attrs:{data:e.presentableData},on:{onSaveEnd:e.savePresentableEnd}})],1)},[],!1,null,"9d68f8de",null);t.default=h.exports},wmkz:function(e,t,a){"use strict";a.r(t);var n=a("7+cO"),s=a("IP6f"),r=a("aNms"),i=a("59r6"),c=a("qTA6"),o={name:"presentable-scheme-detail",components:{ResourceSchemeTree:n.a,ResourceIntroInfo:c.a},data:function(){return{isInitStatus:!1,params:this.$route.params,presentableDetail:{contracts:[],schemes:[],resourceInfo:{}},cachedContractsMap:{}}},mounted:function(){this.initView(this.params)},computed:{},watch:{},methods:{initView:function(e){var t=this;e.presentableId&&s.a.onloadPresentableDetail(e.presentableId).then(function(e){e&&e.contracts&&(t.isInitStatus=!e.contracts.length,e.contracts.slice(0).reduce(function(e,a){return e[t.getSchemeContractKey(a)]=a,e},t.cachedContractsMap),i.a.onloadResourceDetail(e.resourceId).then(function(a){console.log("detail",a),Object.assign(e.resourceInfo,a),e.resourceInfo.contracts=e.contracts,t.presentableDetail=e}))})},loadPresentableSchemes:function(e){var t=this;r.a.onloadSchemesForResource(e).then(function(e){console.log(e),t.presentableDetail.schemes=e})},getSchemeContractKey:function(e){return"".concat(e.authSchemeId,"_").concat(e.policySegmentId)},saveSchemeHandler:function(){var e,t=this,a=this.$refs.schemeTree.getDutyStatements(),n={},s=this.presentableDetail.resourceId,r=this.cachedContractsMap,i=[];a.map(function(e){var a=e.selectedScheme;if(a){n[e.resourceId]=a.authSchemeId;var s=a.selectedPolicy.segmentId,c={resourceId:e.resourceId},o={authSchemeId:a.authSchemeId,policySegmentId:s},l=t.getSchemeContractKey(o);r[l]?c.contractId=r[l].contractId:Object.assign(c,o),i.push(c)}else n[e.resourceId]=e.authSchemeId});for(var c=0;c<a.length;c++)if(a[c].resourceId===s){e=a[c];break}e?2===e.activeStatus?this.updatePresentableSchemes({contracts:i}):this.$message.error("有资源未选择授权策略"):(console.log("error contracts",i),this.$message.error("未选择授权方案"))},updatePresentableSchemes:function(e){var t=this;return this.$services.presentables.put(this.params.presentableId,e).then(function(e){0===e.data.errcode?(t.isInitStatus=!e.data.data.contracts.length,t.$message.success("更新成功"),t.gotoContractView(e.data.data)):t.$error.showErrorMessage(e)})},gotoContractView:function(e){for(var t={tab:"node-contracts"},a=0;a<e.contracts.length;a++){var n=e.contracts[a];if(n.resourceId===this.presentableDetail.resourceId){t.contractId=n.contractId;break}}this.$router.push({path:"/node/".concat(this.params.nodeId),query:t})},switchSchemeHandler:function(e,t,a,n){},selectResourceHandler:function(e,t,a,n){},changePolicy:function(e,t,a){},changeSchemePolicyHandler:function(e,t){},selectAuthSchemeHandler:function(e,t,a){}}},l=(a("iwFP"),a("LxJW"),a("KHd+")),u=Object(l.a)(o,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"presentable-auth-scheme-wrap"},[t("resource-scheme-tree",{ref:"schemeTree",staticClass:"presentable-auth-scheme-tree",attrs:{contracts:this.presentableDetail.resourceInfo.contracts,resource:this.presentableDetail.resourceInfo}}),this._v(" "),t("div",{staticClass:"ft clearfix"},[t("div",{staticClass:"rt-side"},[t("el-button",{staticClass:"ft-btn deep-color-btn",attrs:{type:"primary",round:""},on:{click:this.saveSchemeHandler}},[this._v("\n        "+this._s(this.isInitStatus?"生成合约":"更新合约")+"\n      ")])],1)])],1)},[],!1,null,"2cfc91d5",null);t.default=u.exports},xdK5:function(e,t,a){"use strict";var n=a("tlFn");a.n(n).a},y8CG:function(e,t,a){}}]);