(window.webpackJsonp=window.webpackJsonp||[]).push([["pagebuild"],{"+LUt":function(e,t,r){"use strict";var s=r("0Bse"),a=(r("1O/z"),r("JlKq"));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i={name:"resource-items",data:function(){return{search:"",resources:[],loader:null}},props:{type:{type:String,default:function(){return"all"}}},watch:{type:function(){this.initView()}},components:{ResourceItem:s.a,LazyListView:a.a},mounted:function(){this.initView()},methods:{initView:function(){switch(this.type){case"favor":this.loader=this.getFavorResourcesLoader();break;case"self":this.loader=this.getSelfResourcesLoader()}},fetchData:function(e){var t=this;console.log("fetchData",e);return this.loader?this.loader({page:e}).then(function(e){return t.resources=t.resources.concat(e.dataList),e.dataList.length<10&&(e.canLoadMore=!1),e}):Promise.resolve({canLoadMore:!1,dataList:[]})},getSelfResourcesLoader:function(){var e=this;return this.createResourceLoader(function(t){return e.$services.resource.get(t||{}).then(function(e){return e.getData()})})},getFavorResourcesLoader:function(){var e=this;return this.createResourceLoader(function(t){return e.$services.collections.get(t||{}).then(function(e){return e.getData()})})},createResourceLoader:function(e){return function(t){return"object"===n(t=t||{pageSize:10,page:1})&&(t={params:Object.assign({pageSize:10,page:1},t)}),e(t)}},getAllResourcesLoader:function(e){return"object"===n(e={pageSize:100})&&(e={params:e}),this.$services.resource.get(e||{}).then(function(e){return e.getData()})}}},o=(r("0efm"),r("KHd+")),c=Object(o.a)(i,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"resource-items"},[t("lazy-list-view",{attrs:{list:this.resources,height:90,fetch:this.fetchData},scopedSlots:this._u([{key:"default",fn:function(e){return[t("resource-item",{attrs:{resource:e.data}})]}}])},[t("div",{staticClass:"empty-resource-tip",attrs:{slot:"empty"},slot:"empty"},[this._v("\n      "+this._s("self"===this.type?"没有自制资源":"未收藏资源")+"\n    ")])])],1)},[],!1,null,"428a1981",null);t.a=c.exports},"0Bse":function(e,t,r){"use strict";var s=r("1O/z"),a=r("mL9P"),n={name:"resource-info-item",data:function(){return{}},props:{resource:{type:Object,default:function(){return{}}},type:{type:String,default:"list"}},watch:{},mounted:function(){this.format(this.resource)},methods:{format:function(e){var t=this;this.resource.resourceId&&(e._statusInfo=a.RESOURCE_STATUS[e.status],e._fileSize=this.humanizeSize(e.systemMeta.fileSize),Object(s.c)(e.userId).then(function(r){t.$set(e,"_userInfo",r)}))},humanizeSize:function(e){var t=["B","KB","MB","GB","TB"];if(e<1)return e+"B";var r=Math.min(Math.floor(Math.log(e)/Math.log(1024)),t.length-1);return(e=Number((e/Math.pow(1024,r)).toPrecision(2)))+t[r]},gotoDetail:function(e){this.$router.push("/resource/detail/".concat(e.resourceId))}}},i=(r("r3ZZ"),r("KHd+")),o=Object(i.a)(n,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"resource-item-info",class:["resource-item-theme-type-"+e.type],on:{click:function(t){e.gotoDetail(e.resource)}}},[r("h4",{staticClass:"res-title"},[e._v(e._s(e.resource.resourceName))]),e._v(" "),r("div",{staticClass:"res-intro-detail"},[r("div",{staticClass:"res-intro-bd"},[r("span",{staticClass:"res-type"},[e._v("#"+e._s(e.resource.resourceType))]),e._v(" "),r("span",{staticClass:"res-desc"},[e._v(e._s(e.resource.resourceDesc)+" "+e._s(e.resource.resourceId))])]),e._v(" "),r("div",{staticClass:"res-intro-ft"},[r("span",{staticClass:"res-type"},[e._v("#"+e._s(e.resource.resourceType))]),e._v(" "),e.resource._userInfo?r("span",{staticClass:"res-author"},[e._v("by: "+e._s(e.resource._userInfo.nickname))]):e._e(),e._v(" "),r("span",{staticClass:"update-time"},[e._v("最近更新时间："+e._s(e._f("fmtDate")(e.resource.createDate)))]),e._v(" "),e.resource._statusInfo?r("span",{staticStyle:{"margin-left":"6px"}},[e._v("状态："+e._s(e.resource._statusInfo.desc))]):e._e()])])])},[],!1,null,"0a6a009e",null);t.a=o.exports},"0efm":function(e,t,r){"use strict";var s=r("uefJ");r.n(s).a},"2cqv":function(e,t,r){"use strict";var s=r("7zp4");r.n(s).a},"2z8n":function(e,t,r){"use strict";r.r(t);var s=r("59r6"),a={show:1,hide:2},n={name:"node-page-build-list",data:function(){return{pagebuildList:[],PAGE_BUILD_STATUS:a,currentIndex:1,showSearchResource:!1}},components:{SearchResource:r("H2zm").a},mounted:function(){var e=this;this.loader().then(this.format.bind(this)).then(function(t){e.pagebuildList=t,console.log(e.pagebuildList)})},methods:{loader:function(){var e={nodeId:this.$route.params.nodeId};return this.$services.pagebuild.get({params:e}).then(function(e){var t=e.getData(),r=[];return t.forEach(function(e){var t=s.a.onloadResourceDetail(e.resourceId).then(function(t){return e.resourceDetail=t,t});r.push(t)}),Promise.all(r).then(function(e){return t})})},format:function(e){var t=this;return e.forEach(function(e,r){e.index=r,e.status===a.show&&(t.currentIndex=r),t.formatPageBuild(e)}),e},formatPageBuild:function(e){e.status===a.show?e.statusInfo={desc:"默认展示",type:"success"}:e.statusInfo={desc:"不展示",type:"info"};var t=e.resourceDetail;return t.previewImages.length?e.resourceDetail._previewImage=t.previewImages[0]:t._previewImage="",e},updateStatus:function(){this.pagebuildList.forEach(function(e){e.status=a.hide})},setDefaultPageBuildHandler:function(e,t){t||(t=e.status===a.show?a.hide:a.show);var r={nodeId:parseInt(this.$route.params.nodeId),status:t};return this.changePageBuildShowStatus(e,r)},changePageBuildShowStatus:function(e,t){var r=this;return this.$services.pagebuild.put(e.id,t).then(function(s){if(0!==s.data.errcode)throw new Error(s.data.msg);t.status===a.show&&r.updateStatus(),e.status=t.status,r.formatPageBuild(e)}).catch(this.$error.showErrorMessage)},handlePreview:function(e){this.$router.push({path:"/node/".concat(this.$route.params.nodeId,"/presentable/detail"),query:{presentableId:e.presentableId,ispb:!0}})},changePageBuildHandler:function(e){var t,r=this;t=e.status===a.show?"确定取消使用该页面?":"确定选用该页面?",this.$confirm(t).then(function(){r.setDefaultPageBuildHandler(e).then(function(){r.currentIndex=e.status===a.show?e.index:""})}).catch(function(){})},addNewPageBuildHandler:function(){this.showSearchResource=!0},gotoResourceDetailHandler:function(e){this.$router.push("/resource/detail/".concat(e.resourceId))},addResourceHandler:function(e){var t=this;this.createPresentable({nodeId:this.$route.params.nodeId,presentableName:e.resourceName,resourceId:e.resourceId}).then(function(r){r.resourceDetail=Object.assign({},e),t.pagebuildList.push(t.formatPageBuild(r)),t.showSearchResource=!1}).catch(this.$error.showErrorMessage)},createPresentable:function(e){return this.$services.presentables.post(e).then(function(e){return 0!==e.data.errcode?Promise.reject(e.data.msg):e.getData()})}}},i=(r("G8fh"),r("KHd+")),o=Object(i.a)(n,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"pb-list-container"},[r("header",{staticClass:"nav-title"},[e._v("节点样式")]),e._v(" "),r("ul",{staticClass:"pb-list"},[e._l(e.pagebuildList,function(t){return r("li",{staticClass:"pb-item",class:{selected:t.index===e.currentIndex}},[r("div",{staticClass:"pb-item-wrap"},[r("div",{staticClass:"pb-thumbnail-wrap",on:{click:function(r){e.changePageBuildHandler(t)}}},[r("img",{attrs:{src:t.resourceDetail._previewImage,alt:"预览图"}})]),e._v(" "),r("div",{staticClass:"pb-item-content",on:{click:function(r){e.gotoResourceDetailHandler(t)}}},[r("h4",{staticClass:"pb-title"},[e._v(e._s(t.presentableName))]),e._v(" "),r("div",{staticClass:"pb-desc"},[r("p",{domProps:{innerHTML:e._s(t.resourceDetail.intro+t.resourceDetail.intro+t.resourceDetail.intro+t.resourceDetail.intro+t.resourceDetail.intro+t.resourceDetail.intro+t.resourceDetail.intro+t.resourceDetail.intro)},on:{click:function(r){e.gotoResourceDetailHandler(t)}}})])])])])}),e._v(" "),r("li",{staticClass:"pb-item"},[r("div",{staticClass:"add-pb-area",on:{click:e.addNewPageBuildHandler}},[r("i",{staticClass:"el-icon-plus"})])])],2),e._v(" "),r("el-dialog",{attrs:{visible:e.showSearchResource,width:"840px","close-on-click-modal":!1,top:"10vh",center:""},on:{"update:visible":function(t){e.showSearchResource=t}}},[r("p",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[e._v("添加资源")]),e._v(" "),r("search-resource",{staticClass:"add-resource-input",attrs:{searchScope:{resourceType:"page_build"}},on:{add:e.addResourceHandler}})],1)],1)},[],!1,null,"2d5f9d84",null);t.default=o.exports},"3zXT":function(e,t,r){},"59r6":function(e,t,r){"use strict";r.d(t,"b",function(){return n}),r.d(t,"c",function(){return i});var s=r("3eXy"),a=(r("snnE"),r("LvDl"),r("C2Lv"));function n(e){return s.ResourceService.get(e).then(function(e){return 0===e.data.errcode?e.getData():Promise.reject(e.data)})}var i=function(e){return n(e).then(function(e){return e})};t.a={loadDetail:n,loadResources:function(e){return a.a.get("/v1/resources/list",{params:{resourceIds:e.join(",")}}).then(function(e){return e.getData()})},onloadResourceDetail:i}},"6ydb":function(e,t,r){},"7zp4":function(e,t,r){},G8fh:function(e,t,r){"use strict";var s=r("vCqD");r.n(s).a},H2zm:function(e,t,r){"use strict";var s=r("0Bse"),a=r("+LUt"),n=r("JlKq");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o={name:"search-resource",data:function(){return{searchInput:"",activeName:"favor",favorResources:[],searchResources:[]}},components:{ResourceItem:s.a,ResourceList:a.a,LazyListView:n.a},props:{searchScope:{type:Object,default:function(){return{}}}},watch:{},mounted:function(){this.loader=this.getFavorResourcesLoader()},methods:{addResourceHandler:function(e){this.$emit("add",e)},clearSearchInputHandler:function(){},getFavorResourcesLoader:function(){var e=this;return this.createResourceLoader(function(t){return e.$services.collections.get(t||{}).then(function(e){return e.getData()})})},createResourceLoader:function(e){return function(t){return"object"===i(t=t||{pageSize:10,page:1})&&(t={params:Object.assign({pageSize:10,page:1},t)}),e(t)}},fetchData:function(e){var t=this;return this.loader?this.loader({page:e}).then(function(e){return t.favorResources=t.favorResources.concat(e.dataList),e.dataList.length<10&&(e.canLoadMore=!1),e}):Promise.resolve({canLoadMore:!1,dataList:[]})},searchDataHandler:function(e){var t=this;return this.searchInput?this.$services.g_Resources.get({params:Object.assign({keyWords:encodeURIComponent(this.searchInput)},this.searchScope)}).then(function(e){var r=e.getData()||{};return 0===e.errcode?(t.searchResources=t.searchResources.concat(r.dataList),r.dataList.length<10&&(r.canLoadMore=!1)):r.canLoadMore=!1,r}):Promise.resolve({canLoadMore:!1})},searchHandler:function(){this.activeName="search",this.searchResources=[],this.$refs.searchView.refresh()}}},c=(r("p0A3"),r("2cqv"),r("KHd+")),u=Object(c.a)(o,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"search-resource-wrap"},[r("div",{staticClass:"search-input-area"},[r("el-input",{staticClass:"search-resource-input",attrs:{clearable:"",placeholder:"Search or ID"},on:{clear:e.clearSearchInputHandler},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.searchHandler(t):null}},model:{value:e.searchInput,callback:function(t){e.searchInput=t},expression:"searchInput"}})],1),e._v(" "),r("div",{staticClass:"search-resource-bd"},[r("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[r("el-tab-pane",{attrs:{label:"收藏资源",name:"favor"}},[r("lazy-list-view",{staticClass:"search-resource-list",attrs:{list:e.favorResources,height:90,fetch:e.fetchData},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{staticClass:"add-resource-btn",on:{click:function(r){e.addResourceHandler(t.data)}}},[e._v("添加")]),e._v(" "),r("resource-item",{staticStyle:{"margin-right":"80px"},attrs:{resource:t.data,type:"search"}})]}}])})],1),e._v(" "),r("el-tab-pane",{attrs:{label:"搜索资源",name:"search"}},[r("lazy-list-view",{ref:"searchView",staticClass:"search-resource-list",attrs:{list:e.searchResources,height:90,fetch:e.searchDataHandler},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{staticClass:"add-resource-btn",on:{click:function(r){e.addResourceHandler(t.data)}}},[e._v("添加")]),e._v(" "),r("resource-item",{staticStyle:{"margin-right":"80px"},attrs:{resource:t.data,type:"search"}})]}}])})],1)],1)],1)])},[],!1,null,"0783b56b",null);t.a=u.exports},"I/Ta":function(e,t,r){},JlKq:function(e,t,r){"use strict";var s={name:"fl-lazy-list-view",props:{list:{type:Array,required:!0,default:[],twoWays:!0},height:{type:Number,default:44},fetch:{type:Function}},data:function(){return{lastScrollTop:null,distance:this.height,lineTopHeight:0,lineBottomHeight:0,previewList:[],displayCount:0,canLoadMore:!0,index:1}},mounted:function(){this.initView(),this.$on("reload",this.refresh.bind(this))},beforeDestroy:function(){this.disconnect()},methods:{initView:function(){var e=this;e.$refs.loading.classList.remove("hide"),e.observer=new IntersectionObserver(function(t){t.forEach(function(t){t.intersectionRatio<=0||!1!==e.canLoadMore&&e.load().catch(function(){e.observer.unobserve(e.$refs.loading),e.$refs.loading.classList.add("hide")})})},{rootMargin:"50px 0px"}),e.observer.observe(this.$refs.loading)},load:function(){var e=this;return e.fetch(e.index++).then(function(t){if(e.canLoadMore=t.canLoadMore,e.scrollHandler(t.dataList||[]),!1===e.canLoadMore)return Promise.reject()})},disconnect:function(){this.observer&&this.observer.disconnect()},refresh:function(){this.canLoadMore=!0,this.previewList=[],this.index=1,this.disconnect(),this.initView()},scrollHandler:function(e){this.previewList=this.previewList.concat(e)}},components:{}},a=(r("U1Xs"),r("KHd+")),n=Object(a.a)(s,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"listView",staticClass:"fl-lazy-list-view"},[e.previewList.length?r("ul",{style:{paddingTop:e.lineTopHeight+"px",paddingBottom:e.lineBottomHeight+"px"}},e._l(e.previewList,function(t,s){return r("li",{key:s,style:{height:e.height+"px"}},[e._t("default",null,{data:t})],2)})):e._e(),e._v(" "),0===e.previewList.length?e._t("empty"):e._e(),e._v(" "),e._t("loading",[r("div",{ref:"loading",staticClass:"load-more-gif"},[e._v("loading...")])])],2)},[],!1,null,"94b4b6d8",null);t.a=n.exports},U1Xs:function(e,t,r){"use strict";var s=r("I/Ta");r.n(s).a},mL9P:function(e,t,r){"use strict";r.r(t),r.d(t,"RESOURCE_TYPES",function(){return s}),r.d(t,"RESOURCE_STATUS",function(){return a});var s={widget:"widget",image:"image",audio:"audio",markdown:"markdown",pageBuild:"page_build",revealSlide:"reveal_slide",license:"license"},a=[{desc:"未知状态",type:"danger"},{desc:"未发布",type:"warning"},{desc:"已发布",type:"success"},{desc:"冻结",type:"danger"}]},p0A3:function(e,t,r){"use strict";var s=r("6ydb");r.n(s).a},r3ZZ:function(e,t,r){"use strict";var s=r("3zXT");r.n(s).a},uefJ:function(e,t,r){},vCqD:function(e,t,r){}}]);