(window.webpackJsonp=window.webpackJsonp||[]).push([["group"],{"0Nxv":function(e,t,r){},"3HtX":function(e,t,r){},AhOT:function(e,t,r){"use strict";r.r(t);var a=r("pUs+"),n=r("AlM9"),o=r("DAk/"),s={name:"group-list",data:function(){return{}},components:{TableView:n.a},mounted:function(){},methods:{loader:function(){return function(){return a.b().then(function(e){return e})}},groupDetailHandler:function(e){this.$router.push({path:"/group/detail/".concat(e.groupId)})},resolveGroupType:function(e){for(var t=0;t<o.GROUP_TYPES.length;t++)if(o.GROUP_TYPES[t].value===e.groupType)return o.GROUP_TYPES[t].label;return""}}},i=(r("x0pV"),r("KHd+")),l=Object(i.a)(s,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",[r("div",{staticClass:"group-top-sec"},[r("router-link",{staticClass:"route-link",attrs:{to:"/group/create"}},[r("el-button",{attrs:{type:"primary"}},[e._v("创建新分组")])],1)],1),e._v(" "),r("table-view",{staticClass:"group-list",attrs:{loader:e.loader()}},[r("el-table-column",{attrs:{prop:"groupName",label:"分组描述"}}),e._v(" "),r("el-table-column",{attrs:{prop:"groupId",label:"分组 Id"}}),e._v(" "),r("el-table-column",{attrs:{label:"分组类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.resolveGroupType(t.row))+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"成员数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("humanizeNumber")(t.row.memberCount))+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"small"},on:{click:function(r){e.groupDetailHandler(t.row)}}},[e._v("管理\n        ")])]}}])})],1)],1)},[],!1,null,"244d41a8",null);t.default=l.exports},AlM9:function(e,t,r){"use strict";var a=r("6tqe"),n={name:"table-view",data:function(){return{loading:!1,tableData:[],total:0}},props:{data:{type:Array,default:function(){return[]}},showPagination:{type:Boolean,default:!0},formatHandler:{type:Function,default:null},paginationOptions:{type:Object,default:function(){return{pageSizes:[10,20,30,50]}}},loader:Function,pageMeta:{type:Object,default:function(){var e=a.c.get("PAGE_".concat(this.$route.fullPath,"_index"))||{};return Object.assign({pageSize:10,page:1},e)}}},beforeDestroy:function(){this.pageMeta&&this.pageMeta.keyWords&&delete this.pageMeta.keyWords,a.c.set("PAGE_".concat(this.pageUrl,"_index"),this.pageMeta)},mounted:function(){this.pageUrl=this.$route.fullPath,this.tableData=this.data,this.total=this.tableData.length,this.load(),this.$on("reload",this.reload.bind(this))},methods:{reload:function(e){this.load(e)},load:function(e){var t=this;Object.assign(this.pageMeta,e||{}),this.loader&&(this.loading=!0,this.loader(this.pageMeta).then(function(e){var r=e.getData();if(t.loading=!1,r){var a=r.dataList||r;t.formatHandler&&(a=t.formatHandler(a)),t.tableData=a,r.dataList?(t.total=r.totalItem,t.pageMeta.page=r.page||1):t.total=a.length}else t.$message.error(r.msg)}).catch(function(e){t.$message.warning("加载失败"),t.loading=!1}))},handleSizeChange:function(e){var t={pageSize:e};this.load(t),this.$emit("sizeChange",t)},handleCurrentChange:function(e){var t={page:e};this.load(t),this.$emit("pageChange",t)}}},o=(r("KOIe"),r("KHd+")),s=Object(o.a)(n,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading.body",value:e.loading,expression:"loading",modifiers:{body:!0}}],staticClass:"table-view-wrapper"},[r("el-table",{staticClass:"table",attrs:{data:e.tableData,stripe:"",border:""}},[e._t("default")],2),e._v(" "),r("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.showPagination,expression:"showPagination"}],staticClass:"pagination",attrs:{background:!0,"current-page":e.pageMeta.page,"page-sizes":[10,20,30,50],"page-size":e.pageMeta.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},[],!1,null,"361849fa",null);t.a=s.exports},"DAk/":function(e,t,r){"use strict";r.r(t),r.d(t,"USER_GROUP_TYPE",function(){return a}),r.d(t,"NODE_GROUP_TYPE",function(){return n}),r.d(t,"GROUP_TYPES",function(){return o});var a=1,n=2,o=[{value:a,label:"用户分组"},{value:n,label:"节点分组"}]},HL62:function(e,t,r){},KOIe:function(e,t,r){"use strict";var a=r("0Nxv");r.n(a).a},"TR/A":function(e,t,r){"use strict";var a=r("l6Y5");r.n(a).a},Xz2P:function(e,t,r){"use strict";var a=r("HL62");r.n(a).a},glge:function(e,t,r){},j4jF:function(e,t,r){"use strict";r.r(t);var a=r("pUs+");r("DAk/");var n={name:"group-detail",data:function(){return{detail:{},groupMembers:[],asyncMembers:[],loading:!1}},components:{GroupMemberSelector:r("lqmb").a},mounted:function(){var e=this,t=this.$route.params.groupId;t?this.load(t).then(function(t){var r=[];e.groupMembers=t.members.map(function(e){return r.push(e.memberId),e.memberName||e.memberId}),e.originalMemberIds=r,e.detail=t}):this.$message.error("缺少参数groupId")},methods:{load:function(e){return this.$services.groups.get(e||{}).then(function(e){return e.getData()}).catch(this.$error.showErrorMessage)},getRemoveMembers:function(){var e=this,t=[];return this.detail.members.forEach(function(r){-1===e.groupMembers.indexOf(r.memberName||r.memberId)&&t.push(r.memberId)}),t},getAddMembers:function(){var e=[],t=this.detail.members.map(function(e){return e.memberName}),r=this.detail.members.map(function(e){return e.memberId});return this.groupMembers.forEach(function(a){-1===t.indexOf(a)&&-1===r.indexOf(a)&&e.push(a)}),e},updateDetail:function(){var e=this,t=this.getAddMembers(),r=this.getRemoveMembers();Object(a.c)(this.$route.params.groupId,{addMembers:t,removeMembers:r}).then(function(t){t.data.data?e.$message.success("分组修改成功"):e.$message.error(t.data.msg)}).catch(function(t){e.$message.error(t.response.errorMsg||t)})}}},o=(r("TR/A"),r("KHd+")),s=Object(o.a)(n,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",[r("el-form",{ref:"dataForm",staticClass:"small-el-form",attrs:{"label-position":"right","label-width":"120px"}},[r("el-form-item",{attrs:{label:"groupName"}},[e._v("\n      "+e._s(e.detail.groupName)+"\n    ")]),e._v(" "),r("el-form-item",{attrs:{label:"分组ID"}},[e._v("\n      "+e._s(e.detail.groupId)+"\n    ")]),e._v(" "),r("el-form-item",{attrs:{label:"创建日期"}},[r("span",[e._v(e._s(e._f("fmtDate")(e.detail.createDate)))])]),e._v(" "),r("el-form-item",{attrs:{label:"分组类型"}},[e._v("\n      "+e._s(1===e.detail.groupType?"用户分组":"节点分组")+"\n    ")]),e._v(" "),r("el-form-item",{attrs:{label:"分组成员列表"}},[r("group-member-selector",{attrs:{"group-type":e.detail.groupType},model:{value:e.groupMembers,callback:function(t){e.groupMembers=t},expression:"groupMembers"}})],1),e._v(" "),r("el-form-item",[r("el-button",{staticStyle:{"margin-top":"15px"},attrs:{type:"primary"},on:{click:e.updateDetail}},[e._v("更新")])],1)],1)],1)},[],!1,null,"9983515a",null);t.default=s.exports},l6Y5:function(e,t,r){},lqmb:function(e,t,r){"use strict";var a=r("DAk/"),n={name:"group-member-selector",data:function(){return{groupMembers:[],asyncMembers:[],loading:!1}},props:{value:{type:Array},groupType:{type:[Number,String]}},watch:{groupType:function(){this.groupMembers=[]},value:function(){this.groupMembers=this.value}},mounted:function(){},methods:{queryUserInfo:function(e){var t=this;return this.$services.user.get(e).then(function(e){var r=e.data.data;return r&&(t.asyncMembers=[{label:r.nickname||r.userName,value:r.userId}]),r})},queryNodeInfo:function(e){var t=this;return this.$services.nodes.get(e).then(function(e){var r=e.getData();return r&&(t.asyncMembers=[{label:r.nodeName,value:r.nodeId}]),r})},queryMemberInfo:function(e){var t=this,r=this.groupType;return r===a.NODE_GROUP_TYPE?this.queryNodeInfo(e):r===a.USER_GROUP_TYPE?this.queryUserInfo(e):this.queryUserInfo(e).then(function(r){if(!r)return t.queryNodeInfo(e)})},asyncSearchMembers:function(e){var t=this;this.asyncMembers=[],e.length>=5&&(this.loading=!0,this.queryMemberInfo(e).then(function(){t.loading=!1}).catch(function(e){t.$error.showErrorMessage(e),t.loading=!1}))},changeHandler:function(){this.$emit("input",this.groupMembers)}}},o=(r("Xz2P"),r("KHd+")),s=Object(o.a)(n,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-select",{staticStyle:{width:"500px"},attrs:{multiple:"",filterable:"",remote:"","multiple-limit":200,placeholder:"请输入","remote-method":e.asyncSearchMembers,loading:e.loading},on:{change:e.changeHandler},model:{value:e.groupMembers,callback:function(t){e.groupMembers=t},expression:"groupMembers"}},e._l(e.asyncMembers,function(t){return r("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[r("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))]),e._v(" "),r("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px","padding-right":"20px"}},[e._v(e._s(t.value))])])}))},[],!1,null,"76b6e6da",null);t.a=s.exports},s1bU:function(e,t,r){"use strict";var a=r("glge");r.n(a).a},tLxC:function(e,t,r){"use strict";r.r(t);var a=r("DAk/"),n={groupName:[{required:!0,message:"分组描述不能为空",trigger:"blur"},{min:4,max:20,message:"分组描述长度应为4-20字符",trigger:"blur"}],members:[{validator:function(e,t,r){t&&t.length?r():r(new Error("分组成员至少含有一个成员"))},trigger:"manual"}],groupType:[{required:!0,message:"分组类型不能为空",trigger:"blur"}]},o={name:"group-creator",data:function(){return{formRules:n,options:a.GROUP_TYPES,detail:{groupName:"",members:[],groupType:""}}},components:{GroupMemberSelector:r("lqmb").a},mounted:function(){},methods:{goBackHandler:function(){history.back()},changeGroupType:function(){this.detail.members=[]},submitForm:function(e){var t=this,r=this;r.$refs[e].validate(function(e){if(!e)return!1;r.$services.groups.post(r.detail).then(function(e){0!==e.data.errcode?t.$message.error(e.data.msg):(r.$message.success("分组创建成功"),setTimeout(function(){r.$router.push({path:"/group/list"})},1e3))}).catch(t.$error.showErrorMessage)})}}},s=(r("s1bU"),r("KHd+")),i=Object(s.a)(o,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"group-form-container"},[r("el-form",{ref:"dataForm",staticClass:"group-form",attrs:{model:e.detail,rules:e.formRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"分组描述",prop:"groupName",required:""}},[r("el-input",{model:{value:e.detail.groupName,callback:function(t){e.$set(e.detail,"groupName",t)},expression:"detail.groupName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"分组类型",prop:"groupType",required:""}},[r("el-select",{attrs:{placeholder:"请选择"},on:{change:e.changeGroupType},model:{value:e.detail.groupType,callback:function(t){e.$set(e.detail,"groupType",t)},expression:"detail.groupType"}},e._l(e.options,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"分组成员",prop:"members",required:""}},[r("group-member-selector",{attrs:{"group-type":e.detail.groupType},model:{value:e.detail.members,callback:function(t){e.$set(e.detail,"members",t)},expression:"detail.members"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("dataForm")}}},[e._v("创建分组")]),e._v(" "),r("el-button",{on:{click:e.goBackHandler}},[e._v("取消")])],1)],1)],1)},[],!1,null,"4681896e",null);t.default=i.exports},x0pV:function(e,t,r){"use strict";var a=r("3HtX");r.n(a).a}}]);